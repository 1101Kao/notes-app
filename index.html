<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family:"Meiryo UI", sans-serif; margin:0; }
  body.light { background:#f0f4f8; color:#2a3a50; }
  body.dark  { background:#0f1115; color:#e8edf5; }

  /* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ã—ã¾ã† ===== */
  .sidebar-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.3);
    z-index: 2400; /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ (2500) ã‚ˆã‚Šä¸‹ã« */
    display: none;
    pointer-events: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ */
  }
  .sidebar-overlay.show {
    display: block;
    pointer-events: auto; /* show ã®ã¨ãã ã‘æœ‰åŠ¹åŒ– */
  }

  /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
  .topbar {
    background:#4a90e2; color:#fff;
    padding:8px 12px; position:sticky; top:0; z-index:2000;
  }
  .topbar-inner { display:flex; justify-content:space-between; align-items:center; }
  .topbar-title { font-weight:bold; }
  .topbar-actions { display:flex; flex-wrap:nowrap; gap:4px; overflow-x:auto; }
  .btn {
    padding:4px 8px; cursor:pointer; border:none; border-radius:6px;
    background:#ffffff; color:#2a3a50; font-size:12px; white-space:nowrap;
    font-family:"Meiryo UI",sans-serif;
  }
  .btn:hover { opacity:.9; }
  body.dark .btn { background:#2a3140; color:#e8edf5; }
  .btn-primary { background:#4a90e2; color:#fff; }
  .btn-danger  { background:#e24a4a; color:#fff; }
  .btn-cancel  { background:#fff; border:1px solid #999; color:#333; }

  /* ===== æƒ…å ±ï¼†æ¤œç´¢ ===== */
  #infoPanel { display:none; font-size:12px; margin:8px 16px; color:#556; }
  #filterPanel { margin:8px 16px; }
  #q {
    width:300px;
    max-width:60%;
    padding:6px; border:1px solid #cfd8e3; border-radius:6px;
    font-size:13px; font-family:"Meiryo UI",sans-serif;
  }
  #q::placeholder { color:#999; font-style:italic; }

  /* ===== ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
  .container { display:flex; }
  .sidebar {
    width:200px; border-right:1px solid #d8e1eb; padding:14px;
    background: linear-gradient(180deg,#ffffff,#f7f9fc);
  }
  body.dark .sidebar { background:#1c1f28; border-color:#2a3140; }
  .sidebar h4 { margin:0 0 10px; font-size:13px; color:#6b7a90; }
  .sidebar ul { list-style:none; padding:0; margin:0; }
  .sidebar li {
    cursor:pointer; margin:6px 0; padding:6px 8px; border-radius:6px;
    display:flex; justify-content:space-between; align-items:center; font-size:13px;
  }
  .sidebar li.active { background:#4a90e2; color:#fff; }
  .sidebar .del-btn, .sidebar .edit-btn {
    font-size: 12px; margin-left:6px; cursor:pointer; opacity:0.6;
  }
  .sidebar .del-btn:hover { color:#e24a4a; opacity:1; }
  .sidebar .edit-btn:hover { color:#4a90e2; opacity:1; }

  .cat-input { display:flex; gap:4px; margin-top:8px; }
  .cat-input input { flex:1; padding:4px; font-size:12px; font-family:"Meiryo UI",sans-serif; }
  .cat-input button { flex:0 0 auto; padding:4px 6px; font-size:12px; }

  .main { flex:1; padding:18px; }

  /* ===== ãƒãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ ===== */
  .note {
    border:1px solid #e3e8ef; background:#fff; border-radius:10px;
    padding:12px; margin-bottom:12px; cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,.06);
    font-size:13px; white-space:pre-wrap; word-wrap:break-word;
    display:flex; flex-direction:column; gap:4px;
    font-family:"Meiryo UI",sans-serif;
  }
  .note-header { display:flex; align-items:center; gap:6px; }
  .note h3 { margin:0; font-size:15px; flex:1; }
  .note small { color:#6b7a90; font-size:12px; }
  body.dark .note { background:#141925; border-color:#2a3140; color:#e8edf5; box-shadow:0 2px 8px rgba(0,0,0,.25); }

  /* ===== PCç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
  #dlg {
    display:none; position:absolute;
    width:600px; max-width:95%;
    background:#fff; color:#2a3a50; border:1px solid #d0d7e2; border-radius:10px;
    box-shadow:0 16px 32px rgba(0,0,0,.3); z-index:1000;
    font-size:13px; font-family:"Meiryo UI",sans-serif;
  }
  body.dark #dlg { background:#141925; color:#e8edf5; border-color:#2a3140; }
  #dlgHeader {
    padding:10px 14px; background:#4a90e2; color:#fff; border-radius:10px 10px 0 0;
    cursor:move; user-select:none; font-weight:bold;
  }
  #dlg .content { padding:20px; }
  #dlg input, #dlg textarea, #dlg select {
    display:block;
    width:100%; max-width:100%;
    margin-bottom:10px; padding:8px; border:1px solid #cfd8e3; border-radius:6px;
    font-size:13px; font-family:"Meiryo UI",sans-serif; box-sizing:border-box;
  }
  .modal-footer { text-align:right; }

  /* ===== ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ ===== */
  .mobile-editor {
    position: fixed;
    top: 0;
    left: 100%;
    width: 100%;
    height: 100%;
    background: #fff;
    transition: left 0.3s ease;
    z-index: 3000;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
  }
  .mobile-editor.show { left: 0; }

  .mobile-editor .editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #4a90e2;
    color: #fff;
    font-weight: bold;
  }
  .mobile-editor .editor-header button {
    background: #fff;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
  }
  .mobile-editor .editor-content {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
    background: #fff;
    box-sizing: border-box;
  }
  .mobile-editor .editor-content input,
  .mobile-editor .editor-content textarea,
  .mobile-editor .editor-content select {
    display:block;
    width: 100%; max-width:100%;
    margin-bottom: 12px; padding: 10px;
    border: 1px solid #cfd8e3; border-radius: 6px;
    font-size: 14px; box-sizing: border-box;
  }

  /* ===== æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã®å¹…èª¿æ•´ ===== */
  @media screen and (max-width:600px) {
    #q {
      width:100%;
      max-width:100%;
      display:block;
      margin:0 auto;
    }
  }

  /* ===== ãƒ¢ãƒã‚¤ãƒ«ã§ã‚«ãƒ†ã‚´ãƒªæ“ä½œãƒœã‚¿ãƒ³ã‚’å¤§ãã ===== */
  @media screen and (max-width:600px) {
    .sidebar .edit-btn,
    .sidebar .del-btn {
      font-size:18px;
      padding:4px;
    }
  }

  /* ===== ãƒ¢ãƒã‚¤ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ ===== */
  @media screen and (max-width:600px) {
    .sidebar {
      position: fixed;
      left: -100%;
      top: 0; bottom: 0;
      width: 80%; max-width: 280px;
      background: #fff;
      transition: left 0.3s ease;
      z-index: 2500;
      box-shadow: 2px 0 8px rgba(0,0,0,.2);
    }
    .sidebar.show { left: 0; }

    .menu-toggle {
      display:inline-block;
      font-size:20px;
      margin-right:10px;
      cursor:pointer;
    }

    .note {
      border: none;
      border-bottom: 1px solid #ddd;
      border-radius: 0;
      padding: 12px;
      box-shadow: none;
      background: transparent;
    }
    .note h3 { font-size: 16px; margin: 0 0 4px; font-weight: bold; }
    .note small { display: block; color: #888; margin-bottom: 4px; }
    .note p {
      font-size: 13px; color:#444; margin:0;
      white-space:pre-wrap; /* â† ä¿®æ­£æ¸ˆã¿ */
      overflow:hidden; text-overflow:ellipsis;
    }

    /* ===== ãƒ¢ãƒã‚¤ãƒ«æ–°è¦ãƒœã‚¿ãƒ³ ===== */
    .fab {
      position: fixed;
      bottom: 16px; right: 16px;
      width: 56px; height: 56px;
      border-radius: 50%; border: none;
      background: #2a3a50; color: #fff;
      font-size: 28px; font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer; transition: background 0.3s;
      z-index: 3000;
    }
    .fab:hover { background: #a90e2; }
  }

  /* ===== ã¯ã¿å‡ºã—é˜²æ­¢ ===== */
  .note, .mobile-editor, .editor-content,
  input, textarea, select {
    box-sizing: border-box;
    max-width: 100%;
  }
</style>


</head>
<body class="light">
<!-- ===== Topbar ===== -->
<div class="topbar">
  <div class="topbar-inner">
    <div class="topbar-title">
  <span class="menu-toggle" onclick="toggleCats()">â‰¡</span>Notes
</div>
    <div class="topbar-actions">
      <button class="btn" onclick="toggleInfo()">info</button>
      <button class="btn" onclick="toggleTheme()">tm</button>
      <button class="btn" onclick="exportNotes()">ex</button>
      <input type="file" id="importFile" style="display:none" onchange="importNotes(event)">
      <button class="btn" onclick="document.getElementById('importFile').click()">in</button>
      <button class="btn btn-danger" onclick="deleteSelected()">del</button>
      <button class="btn btn-primary" onclick="openEditor(null); debugCheck()">ï¼‹</button>
    </div>
  </div>
</div>

<!-- æƒ…å ±ï¼†æ¤œç´¢ -->
<div id="infoPanel">å³ä¸Šã®ã€Œï¼‹ã€ã§ãƒãƒ¼ãƒˆä½œæˆã§ãã¾ã™ã€‚ãƒã‚§ãƒƒã‚¯ã‚’ã¤ã‘ã¦ã€Œdelã€ã§ä¸€æ‹¬å‰Šé™¤ã§ãã¾ã™ã€‚</div>
<div id="filterPanel"><input type="text" id="q" placeholder="æ¤œç´¢ã—ãŸã„ãƒ¯ãƒ¼ãƒ‰" onkeyup="render()"></div>

<!-- ===== 2ã‚«ãƒ©ãƒ  ===== -->
<div class="container">
  <div class="sidebar">
    <h4>ã‚«ãƒ†ã‚´ãƒª</h4>
    <ul id="catList"></ul>
    <div class="cat-input">
      <input type="text" id="newCat" placeholder="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒª">
      <button onclick="addCategory()">ï¼‹</button>
    </div>
  </div>
  <div class="main">
    <div id="list"></div>
  </div>
</div>

<!-- ===== PCç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div id="dlg">
  <div id="dlgHeader">ãƒãƒ¼ãƒˆç·¨é›†</div>
  <div class="content">
    <input type="date" id="fDate">
    <select id="fCat"></select>
    <input type="text" id="fTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
    <textarea id="fNotes" placeholder="æœ¬æ–‡" rows="6"></textarea>
    <div class="modal-footer">
      <button class="btn btn-danger" onclick="deleteNote()">å‰Šé™¤</button>
      <button class="btn btn-cancel" onclick="closeEditor()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="saveNote()">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- ===== ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ ===== -->
<div class="mobile-editor" id="mobileEditor">
  <div class="editor-header">
    <span>ãƒãƒ¼ãƒˆç·¨é›†</span>
    <button onclick="closeMobileEditor()">é–‰ã˜ã‚‹</button>
  </div> <!-- â†æŠœã‘ã¦ãŸé–‰ã˜ã‚¿ã‚°ã‚’è¿½åŠ  -->
  <div class="editor-content">
    <input type="date" id="mDate">
    <select id="mCat"></select>
    <input type="text" id="mTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
    <textarea id="mNotes" placeholder="æœ¬æ–‡" rows="8"></textarea>
    <div style="text-align:right; margin-top:10px;">
      <button class="btn btn-primary" onclick="saveNoteMobile(); closeMobileEditor()">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- ãƒ¢ãƒã‚¤ãƒ«æ–°è¦ãƒœã‚¿ãƒ³ -->
<button class="fab" onclick="openMobileEditor()">ï¼‹</button>

<!-- ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ã—ã¾ã†ç”¨ ===== -->
<div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleCats()"></div>

<script>
var notes = [],
    current = null,
    categories = [],
    theme = (function(){
      try { return localStorage.getItem("theme") || "light"; }
      catch(e){ return "light"; }
    })(),
    currentCategory = "all",
    selectedIds = new Set();

/* ===== ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ===== */
function storageGet(k){ try{return localStorage.getItem(k);}catch(e){return null;} }
function storageSet(k,v){ try{localStorage.setItem(k,v);}catch(e){} }

function loadNotes(){
  var d = storageGet("notes");
  if(d){ try{ notes = JSON.parse(d)||[]; }catch(e){ notes=[]; } }
}
function saveNotes(){ storageSet("notes", JSON.stringify(notes)); }

function loadCategories(){
  var d = storageGet("categories");
  if(d){
    try{ categories = JSON.parse(d)||[]; }
    catch(e){ categories=[]; }
  }
  if(!categories.length){
    categories = ["daily","weekly","kb"];
  }
}
function saveCategories(){ storageSet("categories", JSON.stringify(categories)); }

/* ===== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ===== */
function render(){
  var list=document.getElementById('list');
  list.innerHTML='';
  var q=(document.getElementById('q').value||'').toLowerCase();

  // ãƒ”ãƒ³ç•™ã‚ã‚’å„ªå…ˆã—ã¦ä¸¦ã¹ã‚‹
  let sortedNotes = [...notes].sort((a,b)=>{
    if(a.pinned && !b.pinned) return -1;
    if(!a.pinned && b.pinned) return 1;
    return 0;
  });

  sortedNotes.forEach(n=>{
    if(currentCategory!=="all" && n.cat!==currentCategory) return;

    var t=(n.title||"").toLowerCase(),
        body=(n.notes||"").toLowerCase();
    if(q && t.indexOf(q)===-1 && body.indexOf(q)===-1) return;

    var div=document.createElement('div');
    div.className='note';

    var header=document.createElement('div');
    header.className='note-header';

    // ğŸ“Œ ãƒ”ãƒ³ãƒœã‚¿ãƒ³
    var pin=document.createElement('span');
    pin.textContent=n.pinned?"ğŸ“Œ":"ğŸ“";
    pin.style.cursor="pointer";
    pin.onclick=function(e){
      e.stopPropagation();
      n.pinned=!n.pinned;
      saveNotes(); render();
    };

    var chk=document.createElement('input');
    chk.type='checkbox';
    chk.checked=selectedIds.has(n.id);
    chk.onchange=function(e){ toggleSelect(n.id,chk); e.stopPropagation(); };

    var title=document.createElement('h3');
    title.textContent=n.title||"(ç„¡é¡Œ)";

    header.appendChild(pin);
    header.appendChild(chk);
    header.appendChild(title);
    div.appendChild(header);

    var meta=document.createElement('small');
    meta.textContent=n.date+"ï¼ˆ"+n.cat+"ï¼‰";
    div.appendChild(meta);

    var p=document.createElement('p');
    p.textContent=n.notes||"";
    div.appendChild(p);

    div.ondblclick=function(){ openEditorById(n.id); };
    div.onclick=function(e){
      if(e.target.tagName!=="INPUT" && e.target.tagName!=="SPAN"){
        toggleSelect(n.id,chk);
        chk.checked=selectedIds.has(n.id);
      }
    };
    list.appendChild(div);
  });
  renderCategories();
}

function renderCategories(){
  categories.sort((a,b)=>a.localeCompare(b,"ja"));
  var list=document.getElementById("catList");
  list.innerHTML="";

  var allLi=document.createElement("li");
  allLi.textContent="ã™ã¹ã¦";
  if(currentCategory==="all") allLi.classList.add("active");
  allLi.onclick=function(){ setCategory("all"); };
  list.appendChild(allLi);

  categories.forEach(cat=>{
    var li=document.createElement("li");
    if(cat===currentCategory) li.classList.add("active");

    var span=document.createElement("span");
    span.textContent=cat;
    span.style.flex="1";
    li.appendChild(span);

    var edit=document.createElement("span");
    edit.textContent="âœ";
    edit.className="edit-btn";
    edit.onclick=function(e){ e.stopPropagation(); editCategory(cat); };
    li.appendChild(edit);

    var del=document.createElement("span");
    del.textContent="Ã—";
    del.className="del-btn";
    del.onclick=function(e){
      e.stopPropagation();
      if(confirm(cat+" ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
        categories=categories.filter(c=>c!==cat);
        notes=notes.map(n=>{ if(n.cat===cat) n.cat="daily"; return n; });
        saveCategories(); saveNotes(); renderCategories(); render();
      }
    };
    li.appendChild(del);

    li.onclick=function(){ setCategory(cat); };
    list.appendChild(li);
  });

  // ã‚»ãƒ¬ã‚¯ãƒˆã«åæ˜ 
  var sel=document.getElementById("fCat"); if(sel){
    sel.innerHTML="";
    categories.forEach(cat=>{
      var o=document.createElement("option");
      o.value=cat; o.textContent=cat;
      sel.appendChild(o);
    });
  }
  var msel=document.getElementById("mCat"); if(msel){
    msel.innerHTML="";
    categories.forEach(cat=>{
      var o=document.createElement("option");
      o.value=cat; o.textContent=cat;
      msel.appendChild(o);
    });
  }
}

/* ===== ã‚«ãƒ†ã‚´ãƒªæ“ä½œ ===== */
function setCategory(cat){ currentCategory=cat; render(); }
function addCategory(){
  var v=document.getElementById("newCat").value.trim();
  if(!v) return;
  if(categories.includes(v)){
    alert("æ—¢ã«å­˜åœ¨ã—ã¾ã™"); return;
  }
  categories.push(v);
  saveCategories();
  renderCategories();
  document.getElementById("newCat").value="";
}
function editCategory(oldName){
  var newName=prompt("æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªå:",oldName);
  if(!newName||newName.trim()==="") return;
  newName=newName.trim();
  if(categories.includes(newName)){
    alert("æ—¢ã«å­˜åœ¨ã—ã¾ã™"); return;
  }
  categories=categories.map(c=>c===oldName?newName:c);
  notes.forEach(n=>{ if(n.cat===oldName) n.cat=newName; });
  saveCategories(); saveNotes(); render();
}

/* ===== é¸æŠå‰Šé™¤ ===== */
function toggleSelect(id,chk){
  if(selectedIds.has(id)) selectedIds.delete(id);
  else selectedIds.add(id);
}
function deleteSelected(){
  if(selectedIds.size===0){ alert("å‰Šé™¤å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“"); return; }
  if(confirm("é¸æŠã—ãŸãƒãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
    notes=notes.filter(n=>!selectedIds.has(n.id));
    selectedIds.clear();
    saveNotes(); render();
  }
}

/* ===== ã‚¨ãƒ‡ã‚£ã‚¿ ===== */
function openEditor(n){
  current=n||{id:Date.now(),date:todayStr(),cat:categories[0]||"daily",title:'',notes:'',pinned:false};
  if(window.innerWidth<=600){
    document.getElementById('mDate').value=current.date;
    document.getElementById('mCat').value=current.cat;
    document.getElementById('mTitle').value=current.title;
    document.getElementById('mNotes').value=current.notes;
    document.getElementById('mobileEditor').classList.add('show');
  } else {
    document.getElementById('fDate').value=current.date;
    document.getElementById('fCat').value=current.cat;
    document.getElementById('fTitle').value=current.title;
    document.getElementById('fNotes').value=current.notes;
    document.getElementById('dlg').style.display='block';
    centerDialog();
  }
}
function openEditorById(id){ var n=notes.find(x=>x.id===id); if(n) openEditor(n); }
function closeEditor(){ document.getElementById('dlg').style.display='none'; }
function closeMobileEditor(){ document.getElementById('mobileEditor').classList.remove('show'); }

function saveNote(){
  current.date=document.getElementById('fDate').value;
  current.cat=document.getElementById('fCat').value;
  current.title=document.getElementById('fTitle').value;
  current.notes=document.getElementById('fNotes').value;
  var i=notes.findIndex(x=>x.id===current.id);
  if(i>=0) notes[i]=current; else notes.unshift(current);
  saveNotes(); render(); closeEditor();
}
function saveMobileNote(){
  if(!current){ current={id:Date.now(),pinned:false}; notes.unshift(current); }
  current.date=document.getElementById('mDate').value;
  current.cat=document.getElementById('mCat').value;
  current.title=document.getElementById('mTitle').value;
  current.notes=document.getElementById('mNotes').value;
  var i=notes.findIndex(x=>x.id===current.id);
  if(i>=0) notes[i]=current; else notes.unshift(current);
  saveNotes(); render();
}

/* ===== Ex/Import ===== */
function exportNotes(){
  var data=JSON.stringify(notes,null,2);
  var blob=new Blob([data],{type:"application/json"});
  var url=URL.createObjectURL(blob);
  var a=document.createElement("a");
  var d=new Date();
  var fn="notes-"+d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2)+".json";
  a.href=url; a.download=fn;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
function importNotes(e){
  var file=e.target.files[0]; if(!file) return;
  var reader=new FileReader();
  reader.onload=function(evt){
    try{
      var imported=JSON.parse(evt.target.result);
      if(imported&&imported.length){
        imported.forEach(n=>{
          if(notes.some(x=>x.id===n.id)){
            n.id=Date.now()+Math.floor(Math.random()*10000);
          }
        });
        if(confirm("æ—¢å­˜ã®ãƒãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\nã‚­ãƒ£ãƒ³ã‚»ãƒ« = ä¸­æ­¢")){
          notes=notes.concat(imported);
          saveNotes(); render(); alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼");
        }
      }
    }catch(err){ alert("ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—: "+err.message); }
  };
  reader.readAsText(file);
}

/* ===== æƒ…å ±ãƒ»ãƒ†ãƒ¼ãƒ ===== */
function toggleInfo(){
  var p=document.getElementById('infoPanel');
  p.style.display=(p.style.display==='block')?'none':'block';
}
function toggleTheme(){
  theme=(theme==="light")?"dark":"light";
  document.body.className=theme;
  storageSet("theme",theme);
}

/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function todayStr(){
  var d=new Date();
  return d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2);
}

/* ===== åˆæœŸåŒ– ===== */
function init(){
  document.body.className=theme;
  loadNotes();
  loadCategories();
  render();
}
init();

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ‰ãƒ©ãƒƒã‚° ===== */
(function(){
  var dlg=document.getElementById("dlg"),
      header=document.getElementById("dlgHeader");
  var startX=0,startY=0,startLeft=0,startTop=0,dragging=false;

  function getClientWidth(){return document.documentElement.clientWidth||document.body.clientWidth;}
  function getScrollTop(){return document.documentElement.scrollTop||document.body.scrollTop;}
  function centerDialog(){
    var w=getClientWidth();
    var dw=dlg.offsetWidth||520;
    var left=Math.max(10,Math.floor((w-dw)/2));
    var top=getScrollTop()+80;
    dlg.style.left=left+"px";
    dlg.style.top=top+"px";
  }
  window.centerDialog=centerDialog;

  header.onmousedown=function(e){
    dragging=true; startX=e.clientX; startY=e.clientY;
    startLeft=dlg.offsetLeft; startTop=dlg.offsetTop;
    document.onmousemove=function(e2){
      if(!dragging)return;
      var dx=e2.clientX-startX;
      var dy=e2.clientY-startY;
      dlg.style.left=(startLeft+dx)+"px";
      dlg.style.top=(startTop+dy)+"px";
    };
    document.onmouseup=function(){
      dragging=false;
      document.onmousemove=null;
      document.onmouseup=null;
    };
  };
  window.onresize=function(){
    if(dlg.style.display==='block'&&!dragging){ centerDialog(); }
  };
})();

/* ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆ¶å¾¡ ===== */
function toggleCats(){
  const sidebar=document.querySelector(".sidebar");
  const overlay=document.getElementById("sidebarOverlay");
  const isOpen=sidebar.classList.toggle("show");
  if(isOpen){ overlay.classList.add("show"); }
  else { overlay.classList.remove("show"); }
}
</script>

</body>
</html>
